!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.vegemite=t()}(this,function(){const e=require("klona");function t(e,n,o,i){var c,f=e[i++];return f?null==(c=f(o,n))?t(e,n,o,i):"function"==typeof c.then?c.then(o=>t(e,n,o,i)):("object"==typeof c&&(o=c),t(e,n,o,i)):Promise.resolve(o)}return function(n){var o,i={},c={},f=n||{},r=(e,t)=>{e.splice(e.indexOf(t)>>>0,1)};return o={get state(){return e(f)},on:(e,t)=>(i[e]=(i[e]||[]).concat(t),()=>r(i[e],t)),set(n,o){t((c["*"]||[]).concat(o&&c[o]||[]),f,e(f=n),0)},listen:(e,t)=>("function"==typeof e&&(t=e,e="*"),c[e]=(c[e]||[]).concat(t),()=>r(c[e],t)),dispatch:(n,c)=>t(i[n]||[],c,e(f),0).then(e=>o.set(e,n))}}});